import{portfolioData}from"/dist/scripts/portfolio-data.js";import{global}from"/dist/scripts/global.js";import{helpers}from"/dist/scripts/global-helpers.js";const dataAttrs={index:"data-index",name:"data-name"},cssClasses={active:"active",bg:"lightbox__bg",img:"lightbox__img",messageMode:"lightbox--message",sliderMode:"lightbox--slider"};let els,transDurs;function buildLightbox(e=null){e=Handlebars.templates[global.templateSources.lightbox](e);global.els.body.insertAdjacentHTML("afterbegin",e),initLightbox()}function initLightbox(){els={box:document.querySelector("#lightbox"),button:document.querySelector("#lbButton"),closeBtns:Array.from(document.querySelectorAll(".lightbox__closeBtn")),content:document.querySelector("#lbContent"),heading:document.querySelector("#lbHeading"),imageZoomButtons:Array.from(document.querySelectorAll(".lightbox__imageZoom")),overlay:document.querySelector("#lbOverlay"),slideZoomButtons:Array.from(document.querySelectorAll(".lightbox__slideZoom")),wrapper:document.querySelector("#lbWrapper")},transDurs={box:1e3*parseFloat(window.getComputedStyle(els.box).getPropertyValue("transition-duration")),wrapper:1e3*parseFloat(window.getComputedStyle(els.wrapper).getPropertyValue("transition-duration"))},eventListeners()}function eventListeners(){[...els.closeBtns,els.overlay].forEach(e=>e.addEventListener("click",closeLightbox)),els.imageZoomButtons.forEach(e=>e.addEventListener("click",()=>zoomImage(e))),els.slideZoomButtons.forEach(e=>e.addEventListener("click",zoomSlide)),els.button&&els.button.addEventListener("click",e=>global.smoothPageTransitions(e,els.button.href))}function openLightbox(e=!1){e&&els.wrapper.classList.add(cssClasses.messageMode),els.wrapper.classList.add(cssClasses.active),global.fixBodyScroll(),setTimeout(()=>{els.box.classList.add(cssClasses.active)},transDurs.wrapper)}function closeLightbox(){els.box.classList.remove(cssClasses.active),global.unfixBodyScroll(),setTimeout(()=>{els.wrapper.classList.remove(cssClasses.active),window.location.pathname.includes(global.pageURLs.portfolioDetail)||setTimeout(()=>{els.wrapper.classList.remove(cssClasses.messageMode,cssClasses.sliderMode),els.button&&els.button.removeAttribute("href"),[els.content,els.heading].forEach(e=>e.innerHTML=""),Array.from(els.wrapper.querySelectorAll("picture")).forEach(e=>e.remove())},transDurs.wrapper)},transDurs.box)}function zoomImage(e){const t=e.getAttribute(dataAttrs.name);var s,o=Number(e.getAttribute(dataAttrs.index)),l=e.closest("section"),r=window.location.pathname.includes(global.pageURLs.portfolioDetail),a=!!(l&&l.id&&l.id.length)&&l.id,l=`${global.pageURLs.portfolioDetail}?${global.searchParams.piece}=${t}&${global.searchParams.from}=${window.location.pathname}${a?`&${global.searchParams.section}=${a}`:""}`;const i=portfolioData.items.find(e=>e.name===t).media[o];let n=0,c,d,m;if(a=makePictureMarkup(i,cssClasses.img),o=makePictureMarkup(i,cssClasses.bg),els.button&&(els.button.href=decodeURIComponent(l)),els.box.insertAdjacentHTML("beforeend",a),els.overlay.insertAdjacentHTML("afterbegin",o),r)openLightbox();else{d=e.closest(`.${global.cssClasses.portfolioItem}`),c=setTimeout(()=>{d.classList.add(global.cssClasses.portfolioItemLoading)},500),m=document.createElement("img"),s=i.sources.map(e=>e.minScreenSize).sort((e,t)=>e-t);for(let e=0;e<s.length;e++){var u=s[e],g=s[e+1]??!1;if(window.innerWidth>u&&!(g&&window.innerWidth>g)){n=u;break}}m.src=0===n?i.mobileSource:i.sources.find(e=>e.minScreenSize===n).url,m.addEventListener("load",()=>{openLightbox(),clearTimeout(c),d.classList.remove(global.cssClasses.portfolioItemLoading)})}}function makePictureMarkup(e,t){return`
        <picture>
            ${e.sources.map(e=>`
                    <source srcset="${e.url}" media="(min-width: ${e.minScreenSize}px)">`).join("")}

            <img class="${t}" src="${e.mobileSource}" alt="${e.alt}">
        </picture>`}function zoomSlide(){els.wrapper.classList.add(cssClasses.sliderMode),openLightbox()}function message(e){els.heading.innerHTML=e.heading,els.content.innerHTML=e.content,openLightbox(!0)}const lightbox={init:buildLightbox,message:message,get els(){return els}};export{lightbox};