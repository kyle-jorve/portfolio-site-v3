import{global}from"/dist/scripts/global.js";const cssClasses={active:"active",hide:"hide",show:"show",track:"loader__track"},mutationObserverConfig={subtree:!0,childList:!0,characterData:!0,attributes:!0},els={loader:document.querySelector("#loader"),loaderBottom:document.querySelector("#loaderBottom"),track:document.querySelector(`#loader .${cssClasses.track}`)},transDurs={track:1e3*parseFloat(window.getComputedStyle(els.track).getPropertyValue("transition-duration")),loader:1e3*parseFloat(window.getComputedStyle(els.loader).getPropertyValue("transition-duration"))},time=300;let mutationObserver,loadTimeout,revealLoadBar;function initLoader(a=!1){mutationObserver=new MutationObserver((e,t)=>mutationHandler(e,t,a)),revealLoadBar=setTimeout(()=>{els.track.classList.add(cssClasses.active)},300),mutationObserver.observe(document,mutationObserverConfig),loadTimeout=setTimeout(()=>{detectLoad(revealPage,a)},time)}function mutationHandler(e,t,a){clearTimeout(loadTimeout),loadTimeout=setTimeout(()=>{detectLoad(revealPage,a)},time)}function detectLoad(t,a=!1){const o=Array.from(document.querySelectorAll("img"));mutationObserver.disconnect(),o.some(e=>!e.complete)?o.forEach(e=>e.addEventListener("load",()=>{o.every(e=>e.complete)&&(t(),a&&a())})):(t(),a&&a())}function revealPage(){clearTimeout(revealLoadBar),els.track.classList.remove(cssClasses.active),setTimeout(()=>{els.loader.classList.add(cssClasses.hide)},transDurs.track),els.loaderBottom.classList.add(cssClasses.show),global.loaded()}function revealLoader(){els.loaderBottom.classList.add(cssClasses.active)}const loader={init:initLoader,dismiss:revealPage,reveal:revealLoader,detectLoad:detectLoad,transDurs:transDurs};export{loader};